<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="googlebot" content="translate" />
  <link rel="icon" href="/Image and video/Forget.ico" type="image/x-icon">
  <title>Forget password</title>
  <link rel="stylesheet" href="forget_password.css">
  
</head>
<body>
  <div class="container">
    <form  id="panel1" class="panel active" >
      <fieldset>
         <h1>Forget password ?</h1>
      <label for="email"id="emails">Email</label>
      <input type="email" name="email"  id="email" placeholder="abebe@gmail.com"required><br><br>
      <button type="button"  id="emailForm">Send</button>
      </fieldset>
    </form><br>
    
    <form  id="panel2" class="panel" >
      <fieldset>
          <h2>Enter OTP</h2>
      <p>Please enter the one-time password (OTP) that is sent to your email.</p>
      <div id="otp-box">
        <input type="text"  maxlength="1" class="otp-input" name="otp1" required>
        <input type="text"  maxlength="1" class="otp-input"  name="otp2" required>
        <input type="text"  maxlength="1" class="otp-input"  name="otp3" required>
        <input type="text"  maxlength="1" class="otp-input"  name="otp4" required>
      </div>
    
      <div class="otp-container">
  <p>Time: <span id="timer">60</span></p>
  <div id="resend_otp">
    <a href="#" id="sendOTPLink">Resend OTP ?</a>
  </div>
</div><br>
      <button  type="submit" id="otpForm">Verify OTP</button>
      </fieldset>
    </form>
    <br>
    <form id="panel3" class="panel">
      <fieldset>
        <h2>Reset Password</h2>
      <div class="reset">
        <label for="password">Password</label>
      <input type="password" id="password" name="password" class="password" required>
      </div>
      <div class="reset">
        <label for="confirm_password">Confirm Password</label>
      <input type="password" id="confirm_password" name="password" required>
      </div>
      <div class="reset">
        <input type="button" class="btn" id="updateForm" value="Save">
      </div>
      </fieldset>
    </form>
  </div>
  <!-- email -->
  <script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("panel1");
    const button = document.getElementById("emailForm");

    if (!form || !button) {
        console.error("Form or button not found! Ensure elements with IDs 'panel1' and 'emailForm' exist in the DOM when the script runs. Check: 1) Script placement (after HTML or use defer), 2) No duplicate IDs, 3) No other scripts removing the button. Current HTML includes form#panel1 and button#emailForm.");
        return;
    }
    function showPanel(id) {
        document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
        const target = document.getElementById(id);
        if(target) target.classList.add('active');
    }

    button.addEventListener("click", function(e) {
        e.preventDefault(); 

        const emailInput = document.getElementById('email');
        if (!emailInput) {
            alert("Email input not found!");
            return;
        }

        const email = emailInput.value.trim();
        if (email === "") {
            alert("Please enter your email");
            return;
        }
        const formData = new FormData(form);

        fetch("send.php", {
            method: "POST",
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            alert(data.message || "No message returned");
            if (data.status === "success") {
                showPanel('panel2'); 
                startTimer(60);
            }
        })
        .catch(err => {
            console.error("AJAX error:", err);
            alert("Error: " + err.message);
        });
    });
});
</script>
  <!-- password button -->
<script>
document.getElementById("updateForm").addEventListener("click", function () {
    const password = document.getElementById("password").value.trim();
    const confirmPassword = document.getElementById("confirm_password").value.trim();

    
    if (!password || !confirmPassword) {
        alert("Password fields cannot be empty");
        return;
    }

    
    if (password !== confirmPassword) {
        alert("Passwords do not match");
        return;
    }

    
    const formData = new FormData();
    formData.append("password", password);

    formData.append("email", "user@example.com"); 

    fetch("save.php", {
        method: "POST",
        body: formData
    })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                alert(data.message); 
    
            } else {
                alert("Error: " + data.message);
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Something went wrong.");
        });
});

</script>

<!-- otp section -->
<script>
function showPanel(id) {
    document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
    const target = document.getElementById(id);
    if (target) target.classList.add('active');
}

function displayError(message) {
    const errorContainer = document.getElementById('otp-error');
    if (errorContainer) {
        errorContainer.textContent = message;
        errorContainer.style.display = 'block';
    } else {
        alert(message);
    }
}

function clearOTPInputs() {
    document.querySelectorAll('#otp-box .otp-input').forEach(input => input.value = '');
    const errorContainer = document.getElementById('otp-error');
    if (errorContainer) errorContainer.style.display = 'none';
}

function validateOTPInputs() {
    const inputs = Array.from(document.querySelectorAll('#otp-box .otp-input'));
    if (inputs.length < 4) {
        displayError('OTP inputs not found.');
        return false;
    }

    const values = inputs.map(input => input.value.trim());
    for (let v of values) {
        if (v === '') {
            displayError('Please fill all OTP fields.');
            return false;
        }
        if (!/^\d$/.test(v)) {
            displayError('Each OTP field must be a single digit (0-9).');
            return false;
        }
    }

    return values; 
}

document.querySelectorAll('#otp-box .otp-input').forEach((input, index, nodeList) => {
    const inputs = nodeList;

    input.addEventListener('input', function () {
        this.value = this.value.replace(/[^0-9]/g, '').slice(0, 1);
        if (this.value.length === 1 && index < inputs.length - 1) {
            inputs[index + 1].focus();
        }
    });

    input.addEventListener('paste', function (e) {
        e.preventDefault();
        const pasteData = (e.clipboardData || window.clipboardData).getData('text').replace(/[^0-9]/g, '');
        for (let i = 0; i < pasteData.length && (index + i) < inputs.length; i++) {
            inputs[index + i].value = pasteData[i];
        }
    });

    input.addEventListener('keydown', function (e) {
        if (e.key === 'Backspace' && this.value === '' && index > 0) {
            inputs[index - 1].focus();
        }
    });
});

const submitButton = document.querySelector('#otpForm');
if (submitButton) {
    submitButton.addEventListener('click', function (e) {
        e.preventDefault();

        const otpValues = validateOTPInputs();
        if (!otpValues) return;

        const formData = new FormData();
        formData.append('otp1', otpValues[0]);
        formData.append('otp2', otpValues[1]);
        formData.append('otp3', otpValues[2]);
        formData.append('otp4', otpValues[3]);

        submitButton.disabled = true;

        fetch('verify.php', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success' && data.message === 'Verified') {
                alert('OTP Verified Successfully!');
                clearOTPInputs();
                showPanel('panel3'); 
            } else if (data.status === 'failure') {
                alert(data.message); 
                displayError(data.message);
                clearOTPInputs();
            } else {
                const msg = data.message || 'Unknown error';
                alert('Unexpected error: ' + msg);
                displayError(msg);
            }
        })
        .catch(err => {
            console.error('Error:', err);
            alert('An error occurred while verifying OTP.');
            displayError('An error occurred while verifying OTP.');
        })
        .finally(() => {
            submitButton.disabled = false;
        });
    });
}
</script>
</body>
</html>
<script src="forget_password.js"></script>